<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: transparent;
    font-family: Arial, Helvetica, sans-serif;
}

/* CONTENEDOR GENERAL */
#app {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2vh;
}

/* ENCABEZADOS */
h1 {
    font-size: clamp(20px, 6vw, 40px);
    font-weight: 900;
    margin: 0;
    text-align: center;
    color: #000;
}

h2 {
    font-size: clamp(14px, 4vw, 24px);
    font-weight: 700;
    margin: 0;
    text-align: center;
    color: #444;
}

/* RECUADRO AJUSTADO AL TEXTO */
#estado {
    width: 90vw;
    max-width: 900px;
    padding: 4vh 4vw;
    border-radius: 28px;

    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;

    box-sizing: border-box;
}

/* TEXTOS */
#texto-es {
    font-size: clamp(22px, 7vw, 50px);
    font-weight: 900;
    color: white;
    text-align: center;
}

#texto-en {
    margin-top: 1vh;
    font-size: clamp(16px, 5vw, 32px);
    font-weight: 700;
    color: white;
    text-align: center;
}

/* BOT√ìN AVISO (SIEMPRE VISIBLE) */
#btnAudio {
    padding: 12px 22px;
    font-size: 14px;
    font-weight: 800;
    border-radius: 24px;
    border: none;
    background: #0077ff;
    color: white;
}

/* PIE */
#meta {
    font-size: clamp(12px, 3.5vw, 18px);
    color: #555;
    text-align: center;
}

/* ANIMACIONES */
.pulse-open {
    animation: pulseOpen 2.5s infinite;
}
.pulse-closed {
    animation: pulseClosed 1.6s infinite;
}

@keyframes pulseOpen {
    0% { transform: scale(1); }
    50% { transform: scale(1.03); }
    100% { transform: scale(1); }
}

@keyframes pulseClosed {
    0% { transform: scale(1); }
    50% { transform: scale(1.06); }
    100% { transform: scale(1); }
}
</style>
</head>

<body>
<div id="app">

    <h1>ESTADO DEL DESPEGUE:</h1>
    <h2>TAKEOFF STATUS:</h2>

    <div id="estado">
        <div id="texto-es">CARGANDO‚Ä¶</div>
        <div id="texto-en"></div>
    </div>

    <button id="btnAudio" onclick="activarAudio()">
        üîî AV√çSAME / NOTIFY ME
    </button>

    <div id="meta">‚Äî</div>

</div>

<script>
let audioActivo = false;
let estadoAnterior = null;

// Audios
const audioAbierto = new Audio(
  "https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"
);
const audioCerrado = new Audio(
  "https://actions.google.com/sounds/v1/cartoon/descending_whistle_1.ogg"
);

/* ACTIVAR AUDIO (UNA SOLA VEZ) */
function activarAudio() {
    if (audioActivo) return; // ya activado

    audioActivo = true;

    // Desbloqueo obligatorio en m√≥viles
    audioAbierto.volume = 0;
    audioAbierto.play().then(() => {
        audioAbierto.pause();
        audioAbierto.currentTime = 0;
        audioAbierto.volume = 1;
    });

    document.getElementById("btnAudio").innerText =
        "üîî AVISO ACTIVADO / ALERT ENABLED";
}

/* CARGA DE ESTADO */
async function cargarEstado() {
    const url =
    "https://docs.google.com/spreadsheets/d/1ZJ4mVkXZyUVBRXLeiSHI2gSOt7JdcYj92bfKtPujU3g/gviz/tq?tqx=out:json&gid=1147167472";

    try {
        const r = await fetch(url);
        const t = await r.text();
        const j = JSON.parse(
            t.substring(t.indexOf("{"), t.lastIndexOf("}") + 1)
        );

        const estadoRaw = j.table.rows[0].c[0].v.toLowerCase();
        const actualizado = j.table.rows[1].c[0].v;

        const box = document.getElementById("estado");
        const es = document.getElementById("texto-es");
        const en = document.getElementById("texto-en");
        const meta = document.getElementById("meta");

        box.classList.remove("pulse-open", "pulse-closed");

        let estadoActual;

        if (estadoRaw.includes("abierto")) {
            box.style.background = "linear-gradient(#1fe38c, #0a9b5a)";
            es.innerText = "DESPEGUE AUTORIZADO";
            en.innerText = "TAKEOFF ALLOWED";
            box.classList.add("pulse-open");
            estadoActual = "ABIERTO";
        } else {
            box.style.background = "linear-gradient(#c00000, #700000)";
            es.innerText = "DESPEGUE NO AUTORIZADO";
            en.innerText = "TAKEOFF NOT ALLOWED";
            box.classList.add("pulse-closed");
            estadoActual = "CERRADO";
        }

        /* üîä SONIDO EN CADA CAMBIO */
        if (audioActivo && estadoAnterior && estadoAnterior !== estadoActual) {
            if (estadoActual === "ABIERTO") audioAbierto.play();
            if (estadoActual === "CERRADO") audioCerrado.play();
        }

        estadoAnterior = estadoActual;
        meta.innerText = actualizado;

    } catch {
        document.getElementById("estado").style.background = "#999";
        document.getElementById("texto-es").innerText = "ERROR";
        document.getElementById("texto-en").innerText = "";
        document.getElementById("meta").innerText =
            "No se pudo leer el estado";
    }
}

cargarEstado();
setInterval(cargarEstado, 15000);
</script>

</body>
</html>
