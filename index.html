<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estado del Despegue</title>

<style>
body {
    margin: 0;
    padding: 0;
    background: #111;
    font-family: Arial, Helvetica, sans-serif;
    color: white;
    text-align: center;
}

h1 {
    font-size: clamp(26px, 5vw, 50px);
    font-weight: 900;
    margin-top: 25px;
}

h2 {
    font-size: clamp(16px, 3vw, 24px);
    font-weight: 700;
    margin-top: -8px;
    opacity: 0.9;
}

#box{
    width: 92%;
    max-width: 1000px;
    margin: 30px auto;
    padding: 40px 15px;
    font-size: clamp(40px, 10vw, 100px);
    font-weight: 900;
    border-radius: 24px;
    background: linear-gradient(180deg,#c3c7cc,#8a9097);
    color: black;
    transition: transform 0.3s ease;
}

/* LATIDO SUAVE */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.04); }
    100% { transform: scale(1); }
}

.loading {
    animation: pulse 1.6s infinite ease-in-out;
}

#meta {
    margin-top: 14px;
    font-size: clamp(14px, 2.5vw, 20px);
    opacity: 0.8;
}
</style>

</head>
<body>

<h1>ESTADO DEL DESPEGUE:</h1>
<h2>TAKEOFF STATUS:</h2>

<div id="box" class="loading">CARGANDO…</div>
<div id="meta">Última actualización: —</div>

<script>
/* URL GViz con el GID correcto */
const GVIZ_URL = 
 "https://docs.google.com/spreadsheets/d/1ZJ4mVkXZyUVBRXLeiSHI2gSOt7JdcYj92bfKtPujU3g/gviz/tq?tqx=out:json&gid=1147167472";

async function fetchEstado(){
    try {
        // Evitar caché
        const res = await fetch(GVIZ_URL + "&_=" + Date.now());
        const txt = await res.text();

        // Extraer JSON válido
        const json = JSON.parse(
            txt.substring(txt.indexOf("{"), txt.lastIndexOf("}") + 1)
        );

        const rows = json.table.rows;

        const estadoRaw = (rows[0].c[0] && rows[0].c[0].v) ? rows[0].c[0].v : "";
        const fechaRaw  = (rows[1].c[0] && rows[1].c[0].v) ? rows[1].c[0].v : "";

        const box = document.getElementById("box");
        const meta = document.getElementById("meta");

        // Texto
        const text = estadoRaw.toString().trim().toUpperCase();

        // Quitar animación de carga
        box.classList.remove("loading");

        if(text.includes("ABIERTO")){
            box.style.background = "linear-gradient(180deg,#2dd27a,#10723f)";
            box.style.color = "#fff";
            box.textContent = "ABIERTO";
            meta.textContent = fechaRaw;
        }
        else if(text.includes("CERRADO")){
            box.style.background = "linear-gradient(180deg,#d53838,#7a0b0b)";
            box.style.color = "#fff";
            box.textContent = "CERRADO";
            meta.textContent = fechaRaw;
        }
        else {
            box.style.background = "linear-gradient(180deg,#888,#555)";
            box.style.color = "#fff";
            box.textContent = text || "SIN ESTADO";
            meta.textContent = fechaRaw;
        }

    } catch(err) {
        // Mostrar error
        const box = document.getElementById("box");
        const meta = document.getElementById("meta");
        box.classList.remove("loading");
        box.style.background = "linear-gradient(180deg,#444,#222)";
        box.style.color = "#fff";
        box.textContent = "ERROR";
        meta.textContent = "No se pudo leer el estado";
        console.error("fetchEstado error:", err);
    }
}

// Primera carga
fetchEstado();

// Repetir cada 15s
setInterval(fetchEstado, 15000);
</script>

</body>
</html>
