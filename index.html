<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: transparent;
    font-family: Arial, Helvetica, sans-serif;
}

/* CONTENEDOR GENERAL */
#app {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2vh;
}

/* ENCABEZADOS */
h1 {
    font-size: clamp(20px, 6vw, 40px);
    font-weight: 900;
    margin: 0;
    text-align: center;
    color: #000;
}

h2 {
    font-size: clamp(14px, 4vw, 24px);
    font-weight: 700;
    margin: 0;
    text-align: center;
    color: #444;
}

/* RECUADRO PRINCIPAL (SE AJUSTA AL TEXTO) */
#estado {
    width: 90vw;
    max-width: 900px;
    padding: 4vh 4vw;
    border-radius: 28px;

    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;

    box-sizing: border-box;
}

/* TEXTO */
#texto-es {
    font-size: clamp(22px, 7vw, 50px);
    font-weight: 900;
    color: white;
    text-align: center;
}

#texto-en {
    margin-top: 1vh;
    font-size: clamp(16px, 5vw, 32px);
    font-weight: 700;
    color: white;
    text-align: center;
}

/* PIE */
#meta {
    font-size: clamp(12px, 3.5vw, 18px);
    color: #555;
    text-align: center;
}

/* ANIMACIONES */
.pulse-open {
    animation: pulseOpen 2.5s infinite;
}
.pulse-closed {
    animation: pulseClosed 1.6s infinite;
}

@keyframes pulseOpen {
    0% { transform: scale(1); }
    50% { transform: scale(1.03); }
    100% { transform: scale(1); }
}

@keyframes pulseClosed {
    0% { transform: scale(1); }
    50% { transform: scale(1.06); }
    100% { transform: scale(1); }
}
</style>
</head>

<body>
<div id="app">

    <h1>ESTADO DEL DESPEGUE:</h1>
    <h2>TAKEOFF STATUS:</h2>

    <div id="estado">
        <div id="texto-es">CARGANDO…</div>
        <div id="texto-en"></div>
    </div>

    <div id="meta">—</div>

</div>

<script>
let estadoAnterior = null;

async function cargarEstado() {
    const url =
    "https://docs.google.com/spreadsheets/d/1ZJ4mVkXZyUVBRXLeiSHI2gSOt7JdcYj92bfKtPujU3g/gviz/tq?tqx=out:json&gid=1147167472";

    try {
        const r = await fetch(url);
        const t = await r.text();
        const j = JSON.parse(
            t.substring(t.indexOf("{"), t.lastIndexOf("}") + 1)
        );

        const estadoRaw = j.table.rows[0].c[0].v.toLowerCase();
        const actualizado = j.table.rows[1].c[0].v;

        const box = document.getElementById("estado");

        box.classList.remove("pulse-open", "pulse-closed");

        if (estadoRaw.includes("abierto")) {
            box.style.background = "linear-gradient(#1fe38c, #0a9b5a)";
            document.getElementById("texto-es").innerText =
                "DESPEGUE AUTORIZADO";
            document.getElementById("texto-en").innerText =
                "TAKEOFF ALLOWED";
            box.classList.add("pulse-open");
        } else {
            box.style.background = "linear-gradient(#c00000, #700000)";
            document.getElementById("texto-es").innerText =
                "DESPEGUE NO AUTORIZADO";
            document.getElementById("texto-en").innerText =
                "TAKEOFF NOT ALLOWED";
            box.classList.add("pulse-closed");
        }

        document.getElementById("meta").innerText = actualizado;

    } catch {
        document.getElementById("estado").style.background = "#999";
        document.getElementById("texto-es").innerText = "ERROR";
        document.getElementById("texto-en").innerText = "";
        document.getElementById("meta").innerText =
            "No se pudo leer el estado";
    }
}

cargarEstado();
setInterval(cargarEstado, 15000);
</script>

</body>
</html>
