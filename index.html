<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: transparent;
    font-family: Arial, Helvetica, sans-serif;
}

#app {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.4vh;
}

h1 {
    color: #000;
    font-weight: 900;
    font-size: clamp(20px, 6vw, 40px);
    margin: 0;
    text-align: center;
}

h2 {
    color: #444;
    font-weight: 700;
    font-size: clamp(14px, 4vw, 24px);
    margin: 0;
    text-align: center;
}

/* üî• RECUADRO PRINCIPAL */
#estado {
    width: 90vw;
    min-height: 38vh;      /* M√ÅS ALTO */
    padding: 3vh 2vw;      /* ESPACIO INTERIOR */
    border-radius: 26px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-weight: 900;
    text-align: center;
    box-sizing: border-box;
}

/* TEXTO */
#texto {
    font-size: clamp(28px, 9vw, 64px);
    color: black;
}

#subtexto {
    font-size: clamp(16px, 4.5vw, 26px);
    margin-top: 0.5vh;
    color: black;
}

#aviso {
    margin-top: 1.2vh;
    font-size: clamp(13px, 3.8vw, 20px);
    font-weight: 600;
    line-height: 1.25;
    color: black;
}

#meta {
    color: #555;
    font-size: clamp(12px, 3.2vw, 18px);
    text-align: center;
}

/* ANIMACIONES */
.pulse-open {
    animation: pulseOpen 2.5s infinite;
}

.pulse-closed {
    animation: pulseClosed 1.6s infinite;
}

@keyframes pulseOpen {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.03); }
    100% { transform: scale(1); }
}

@keyframes pulseClosed {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.06); }
    100% { transform: scale(1); }
}
</style>
</head>

<body>
<div id="app">

    <h1>ESTADO DEL DESPEGUE:</h1>
    <h2>TAKEOFF STATUS:</h2>

    <div id="estado">
        <div id="texto">CARGANDO‚Ä¶</div>
        <div id="subtexto"></div>
        <div id="aviso"></div>
    </div>

    <div id="meta">√öltima actualizaci√≥n: ‚Äî</div>

</div>

<script>
async function cargarEstado() {
    const url =
    "https://docs.google.com/spreadsheets/d/1ZJ4mVkXZyUVBRXLeiSHI2gSOt7JdcYj92bfKtPujU3g/gviz/tq?tqx=out:json&gid=1147167472";

    try {
        const r = await fetch(url);
        const t = await r.text();
        const j = JSON.parse(t.substring(t.indexOf("{"), t.lastIndexOf("}") + 1));

        const estadoRaw = j.table.rows[0].c[0].v.toLowerCase();
        const actualizado = j.table.rows[1].c[0].v;

        const box = document.getElementById("estado");
        const texto = document.getElementById("texto");
        const sub = document.getElementById("subtexto");
        const aviso = document.getElementById("aviso");
        const meta = document.getElementById("meta");

        box.classList.remove("pulse-open", "pulse-closed");

        if (estadoRaw.includes("abierto")) {
            box.style.background = "linear-gradient(#1fe38c, #0a9b5a)";
            texto.innerText = "ABIERTO";
            sub.innerText = "OPEN";
            aviso.innerHTML = "Despegue autorizado<br>Takeoff allowed";
            box.classList.add("pulse-open");
        } else {
            box.style.background = "linear-gradient(#c00000, #700000)";
            texto.innerText = "CERRADO";
            sub.innerText = "CLOSED";
            aviso.innerHTML = "Despegue NO autorizado<br>Takeoff NOT allowed";
            box.classList.add("pulse-closed");
        }

        meta.innerText = actualizado;

    } catch (e) {
        const box = document.getElementById("estado");
        document.getElementById("texto").innerText = "ERROR";
        document.getElementById("subtexto").innerText = "";
        document.getElementById("aviso").innerText = "No se pudo leer el estado";
        box.style.background = "#ccc";
        box.classList.remove("pulse-open", "pulse-closed");
        document.getElementById("meta").innerText = "‚Äî";
    }
}

cargarEstado();
setInterval(cargarEstado, 15000);
</script>
</body>
</html>
