<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Estado del despegue — Autoajustable</title>

  <style>
    /* ===== Reset y layout ===== */
    html,body{
      height:100%;
      margin:0;
      padding:0;
      box-sizing:border-box;
      background:#0f1720;
      color:#fff;
      font-family:Inter,system-ui,Arial,Helvetica,sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
    }
    *,*::before,*::after{ box-sizing:inherit }

    /* Contenedor visible dentro del iframe */
    .viewport{
      width:100%;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:env(safe-area-inset-top,12px) env(safe-area-inset-right,10px)
              env(safe-area-inset-bottom,12px) env(safe-area-inset-left,10px);
      overflow:hidden;
    }

    /* Área base que se escalará automáticamente */
    .base{
      width:980px;
      height:720px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* Tarjeta principal */
    .card{
      width:94%;
      height:86%;
      background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));
      border-radius:18px;
      padding:24px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:12px;
      box-shadow:0 10px 40px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.03);
      overflow:hidden;
    }

    /* ===== Encabezado bilingüe ===== */
    .title{
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      margin-bottom:8px;
      gap:4px;
    }
    .title .main,
    .title .sub{
      font-weight:900;         /* NEGRITA */
      text-transform:uppercase; /* MAYÚSCULAS */
      letter-spacing:1px;
    }
    .title .main{
      font-size:28px;
      color:#e6eef6;
    }
    .title .sub{
      font-size:18px;
      color:#a8b6c6;
    }

    /* ===== Badge de estado ===== */
    .badge{
      width:100%;
      height:58%;
      border-radius:14px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:12px;
      text-align:center;
      font-weight:900;
      letter-spacing:1px;
      color:#fff;
      transition:transform 420ms cubic-bezier(.2,.9,.3,1),
                 box-shadow 420ms, background 420ms;
      will-change:transform,box-shadow,background;
      overflow:hidden;
    }
    .badge .mainText{
      font-size:64px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .badge .sub{
      margin-top:10px;
      font-size:18px;
      font-weight:800;
    }

    .meta{
      margin-top:6px;
      color:#cbd5e1;
      font-size:14px;
    }

    /* Colores del estado */
    .open{ background:linear-gradient(180deg,#06d6a0,#028a5f); color:#002017; }
    .closed{ background:linear-gradient(180deg,#ff5b5b,#9b0e0e); color:#2b0000; }
    .unknown{ background:linear-gradient(180deg,#9aa0a6,#6f757a); color:#0f1011; }

    /* Animaciones */
    @keyframes pop{
      0%{ transform:scale(0.92); opacity:0 }
      60%{ transform:scale(1.03); opacity:1 }
      100%{ transform:scale(1) }
    }
    @keyframes pulse{
      0%{ transform:scale(1) }
      50%{ transform:scale(1.02) }
      100%{ transform:scale(1) }
    }
    .pop{ animation:pop 520ms cubic-bezier(.2,.9,.3,1) both }
    .pulse{ animation:pulse 880ms ease }

    @media(prefers-reduced-motion:reduce){
      .pop,.pulse{ animation:none!important }
      .badge{ transition:none!important }
    }

  </style>
</head>

<body>
  <div class="viewport">
    <div id="baseWrap" class="base">
      <div class="card">

        <!-- ===== Encabezado ===== -->
        <div class="title">
          <div class="main"><strong>ESTADO DEL DESPEGUE:</strong></div>
          <div class="sub"><strong>TAKEOFF STATUS:</strong></div>
        </div>

        <!-- ===== Estado ===== -->
        <div id="badge" class="badge unknown pop">
          <span id="mainText" class="mainText">CARGANDO…</span>
          <span id="subText" class="sub"></span>
        </div>

        <div id="meta" class="meta">Última actualización: —</div>

      </div>
    </div>
  </div>

<script>
/* ============ CONFIG ============ */
const SHEET_ID = "1ZJ4mVkXZyUVBRXLeiSHI2gSOt7JdcYj92bfKtPujU3g";
const GID = 0;
const POLL_INTERVAL = 10000;
const FULL_RELOAD = 15000;

/* Referencias DOM */
const baseWrap = document.getElementById("baseWrap");
const badge = document.getElementById("badge");
const mainText = document.getElementById("mainText");
const subText = document.getElementById("subText");
const meta = document.getElementById("meta");

const BASE_WIDTH = 980;
const BASE_HEIGHT = 720;

/* ============ AJUSTE AUTOMÁTICO A MÓVIL / IFRAME ============ */
function fit(){
  const w = window.innerWidth;
  const h = window.innerHeight;
  const scale = Math.min(w / BASE_WIDTH, h / BASE_HEIGHT, 1);

  baseWrap.style.transform = `scale(${scale})`;
  baseWrap.style.transformOrigin = "center center";
  baseWrap.style.width = BASE_WIDTH + "px";
  baseWrap.style.height = BASE_HEIGHT + "px";
}

window.addEventListener("resize", fit);
window.addEventListener("orientationchange", ()=>setTimeout(fit,200));
fit();

/* ============ LECTURA GVIZ ============ */
async function fetchGviz(){
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json`;
  const res = await fetch(url, { cache:"no-store" });
  const text = await res.text();

  const match = text.match(/setResponse\(([\s\S]*)\);?/);
  if(!match) throw new Error("No JSON GViz");

  const raw = match[1];
  const jsonStart = raw.indexOf("{");
  let depth=0, end=-1;

  for(let i=jsonStart;i<raw.length;i++){
    if(raw[i]=="{") depth++;
    if(raw[i]=="}") depth--;
    if(depth===0){ end=i; break; }
  }

  const json = JSON.parse(raw.slice(jsonStart, end+1));
  const row = json.table.rows[0];
  return row?.c?.[0]?.v || "";
}

/* ============ ACTUALIZAR UI ============ */
function updateUI(state){
  const up = state.toUpperCase();

  badge.classList.remove("open","closed","unknown","pop","pulse");
  void badge.offsetWidth;

  if(up.includes("ABIER") || up.includes("OPEN")){
    badge.classList.add("open","pop","pulse");
    mainText.textContent="ABIERTO";
    subText.textContent="OPEN";

  } else if(up.includes("CERR") || up.includes("CLOSED")){
    badge.classList.add("closed","pop","pulse");
    mainText.textContent="CERRADO";
    subText.textContent="CLOSED";

  } else {
    badge.classList.add("unkn
